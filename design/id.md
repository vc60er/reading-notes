# 分布式id服务


## 全局唯一

## 全局唯一，趋势有序
趋势有序

## 全局唯一，局部有序

局部是相对于全局有序来说的，换句话说，就是在某个范围内是有序的，比如说按照用户划分，分配每个用户的id是可以保证有序

### 微信msg id

**实现原理**

1. 如果要保证严格有序，那么这些id必须同时由一个机器来来产生
2. 持久化存储每个用户的最大id
3. 分配服务一次从持久化存储中获取一段id，
4. 分配服务通过在内存中基于最小的id累积来实现分配，累加到最大值之后，再回到第3步骤
5. 为了减少从持久化存储中获取id的次数，多个用户的共用一个最大id

**高可用的实现方式**

某个用户的id同时只能被一个服务分配，所以需要一种路由机制，准确的告诉请求方，某个用户的请求是由哪个服务分配的。

分配服务按照uid的范围，加载这些用户的初始id。

响应数据中包含uid到分配服务的路由表


**参考资料**

- <http://www.52im.net/thread-1998-1-1.html>
- <http://www.52im.net/thread-1999-1-1.html>


